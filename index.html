<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VoxValt">
    <meta name="description" content="Free AI voice memo assistant with smart reminders">
    
    <title>VoxValt - Voice Memory Assistant</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22VoxValt%22%2C%22short_name%22%3A%22VoxValt%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23667eea%22%2C%22theme_color%22%3A%22%23667eea%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%2520viewBox%3D%270%25200%2520100%2520100%27%253E%253Crect%2520width%3D%27100%27%2520height%3D%27100%27%2520rx%3D%2720%27%2520fill%3D%27%2523667eea%27%2F%253E%253Ctext%2520x%3D%2750%27%2520y%3D%2768%27%2520font-size%3D%2755%27%2520text-anchor%3D%27middle%27%253E%25F0%259F%258E%2599%253C%2Ftext%253E%253C%2Fsvg%253E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23667eea'/%3E%3Ctext x='50' y='68' font-size='55' text-anchor='middle'%3Eüéô%3C/text%3E%3C/svg%3E">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EüéôÔ∏è%3C/text%3E%3C/svg%3E">

    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.15);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.15);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.15);
            --info: #3b82f6;
            --info-bg: rgba(59, 130, 246, 0.15);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border: #e5e7eb;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0,0,0,0.25);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { overscroll-behavior: none; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: var(--text-primary);
            line-height: 1.6;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
            padding-bottom: calc(85px + var(--safe-bottom));
        }

        /* iOS Install Banner - Special Design */
        .ios-install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            padding: 1.25rem;
            padding-bottom: calc(1.25rem + var(--safe-bottom));
            z-index: 9999;
            display: none;
            animation: slideUp 0.4s ease;
        }

        .ios-install-banner.show {
            display: block;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .ios-install-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .ios-install-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .ios-install-close {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ios-install-steps {
            display: flex;
            flex-direction: column;
            gap: 0.875rem;
        }

        .ios-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .ios-step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .ios-step-content {
            flex: 1;
        }

        .ios-step-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .ios-step-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .ios-step-icon {
            font-size: 1.5rem;
        }

        .share-icon-box {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--info);
            border-radius: 8px;
            color: white;
        }

        .share-icon-box svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Android Install Banner */
        .android-install-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--gradient-primary);
            color: white;
            padding: 0.75rem 1rem;
            padding-top: calc(0.75rem + var(--safe-top));
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .android-install-banner.show {
            display: flex;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .android-install-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .android-install-icon { font-size: 1.5rem; }
        .android-install-text { font-size: 0.8rem; }
        .android-install-text strong { display: block; font-size: 0.9rem; }

        .android-install-actions { display: flex; gap: 0.375rem; }

        .android-btn {
            padding: 0.4rem 0.875rem;
            border: none;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }

        .android-btn-primary { background: white; color: var(--primary); }
        .android-btn-secondary { background: rgba(255,255,255,0.2); color: white; }

        /* Notification Banner */
        .notif-banner {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: var(--radius-xl);
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .notif-banner.show { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .notif-content { display: flex; align-items: flex-start; gap: 0.625rem; }
        .notif-icon { font-size: 1.25rem; }
        .notif-body { flex: 1; }
        .notif-title { font-weight: 700; color: #78350f; font-size: 0.9rem; }
        .notif-desc { font-size: 0.8rem; color: #92400e; margin-bottom: 0.5rem; }
        .notif-actions { display: flex; gap: 0.375rem; }

        .notif-btn {
            padding: 0.4rem 0.75rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }

        .notif-btn-primary { background: #78350f; color: white; }
        .notif-btn-secondary { background: rgba(120,53,15,0.1); color: #78350f; }

        /* Header */
        .header { text-align: center; margin-bottom: 1rem; padding-top: 0.5rem; }
        .header-icon { font-size: 2.5rem; animation: float 3s ease-in-out infinite; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }

        .header-title {
            font-size: 2.25rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle { font-size: 0.9rem; color: var(--text-secondary); }

        .header-badges { display: flex; justify-content: center; gap: 0.375rem; margin-top: 0.5rem; flex-wrap: wrap; }

        .badge {
            padding: 0.25rem 0.625rem;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
            font-weight: 600;
        }

        .badge-pwa { background: var(--gradient-primary); color: white; }
        .badge-free { background: var(--success); color: white; }
        .badge-status { background: var(--warning); color: white; }

        /* Standalone Mode Banner */
        .standalone-badge {
            display: none;
            background: var(--success);
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border-radius: var(--radius-lg);
        }

        .standalone-badge.show { display: block; }

        /* Recording Card */
        .recording-card {
            background: var(--gradient-primary);
            border-radius: var(--radius-2xl);
            padding: 1.75rem 1.25rem;
            box-shadow: var(--shadow-2xl);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .recording-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23fff' fill-opacity='0.03'%3E%3Cpath d='M20 20v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4z'/%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .recording-content { text-align: center; position: relative; z-index: 1; }

        .mic-wrapper { position: relative; display: inline-block; margin-bottom: 1rem; }

        .mic-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            font-size: 2.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
            z-index: 2;
        }

        .mic-btn:hover { transform: scale(1.05); background: rgba(255,255,255,0.3); }
        .mic-btn:active { transform: scale(0.95); }

        .mic-btn.recording {
            background: var(--danger);
            border-color: rgba(255,255,255,0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.7); }
            50% { box-shadow: 0 0 0 20px rgba(239,68,68,0); }
        }

        .pulse-ring {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 120px; height: 120px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.4);
            opacity: 0;
            pointer-events: none;
        }

        .mic-wrapper.recording .pulse-ring { animation: ring 2s cubic-bezier(0.4,0,0.6,1) infinite; }
        .pulse-ring:nth-child(2) { animation-delay: 0.5s; }
        .pulse-ring:nth-child(3) { animation-delay: 1s; }

        @keyframes ring {
            0% { width: 120px; height: 120px; opacity: 0.6; }
            100% { width: 200px; height: 200px; opacity: 0; }
        }

        .btn-label { color: white; font-size: 0.95rem; font-weight: 600; }
        .btn-hint { color: rgba(255,255,255,0.75); font-size: 0.75rem; margin-top: 0.125rem; }

        .duration {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            font-family: 'SF Mono', monospace;
            margin-top: 0.875rem;
            letter-spacing: 2px;
            display: none;
        }

        .duration.active { display: block; }

        .visualizer {
            display: none;
            align-items: flex-end;
            justify-content: center;
            gap: 3px;
            height: 50px;
            margin-top: 0.875rem;
        }

        .visualizer.active { display: flex; }

        .audio-bar {
            width: 4px;
            min-height: 4px;
            background: rgba(255,255,255,0.4);
            border-radius: 2px;
            transition: height 0.05s ease;
        }

        .audio-bar.active { background: linear-gradient(to top, #fbbf24, #f59e0b, #ef4444); }

        .live-transcript {
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 0.75rem;
            margin-top: 0.875rem;
            display: none;
            text-align: left;
            max-height: 70px;
            overflow-y: auto;
        }

        .live-transcript.active { display: block; }

        .transcript-label { font-size: 0.65rem; color: rgba(255,255,255,0.6); margin-bottom: 0.25rem; }
        .transcript-text { color: white; font-size: 0.8rem; line-height: 1.4; }

        .status-bar {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            background: rgba(255,255,255,0.15);
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-full);
            margin-top: 0.875rem;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-dot.offline { background: var(--warning); }
        .status-dot.recording { background: var(--danger); animation: blink 0.5s infinite; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .status-text { color: rgba(255,255,255,0.9); font-size: 0.7rem; font-weight: 500; }

        /* Processing */
        .processing {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: var(--radius-2xl);
        }

        .processing.active { display: flex; }

        .processing-content { text-align: center; color: white; }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.75rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .processing-text { font-size: 0.9rem; font-weight: 600; }
        .processing-sub { font-size: 0.75rem; opacity: 0.8; }

        /* Tabs */
        .tabs-container {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .tabs-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            position: relative;
            transition: all 0.2s;
        }

        .tab-btn:hover { color: var(--text-primary); }
        .tab-btn.active { color: var(--primary); background: white; }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0; right: 0;
            height: 2px;
            background: var(--gradient-primary);
        }

        .tab-count {
            background: var(--bg-tertiary);
            padding: 0.1rem 0.4rem;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
        }

        .tab-btn.active .tab-count { background: var(--gradient-primary); color: white; }

        .tab-content { display: none; padding: 1rem; max-height: 350px; overflow-y: auto; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        /* Cards */
        .memo-card, .reminder-card {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 0.875rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .memo-card:hover, .reminder-card:hover { box-shadow: var(--shadow-md); }

        .memo-header { display: flex; align-items: flex-start; gap: 0.5rem; margin-bottom: 0.5rem; }

        .memo-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .memo-info { flex: 1; }
        .memo-time { font-size: 0.7rem; color: var(--text-light); }
        .memo-dur { font-size: 0.8rem; font-weight: 600; }
        .memo-actions { display: flex; gap: 0.25rem; }

        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-md);
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .action-btn:hover { background: var(--bg-secondary); color: var(--text-primary); }
        .action-btn.delete:hover { background: var(--danger-bg); color: var(--danger); }

        .memo-audio {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-secondary);
            padding: 0.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 0.5rem;
        }

        .play-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .play-btn:hover { transform: scale(1.05); }

        .progress-wrap { flex: 1; }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            cursor: pointer;
            overflow: hidden;
        }

        .progress-fill { height: 100%; background: var(--gradient-primary); width: 0%; transition: width 0.1s; }

        .audio-time {
            display: flex;
            justify-content: space-between;
            font-size: 0.55rem;
            color: var(--text-light);
            margin-top: 0.125rem;
            font-family: monospace;
        }

        .memo-text {
            font-size: 0.85rem;
            color: var(--text-primary);
            line-height: 1.5;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 0.5rem;
        }

        .memo-chips { display: flex; gap: 0.25rem; flex-wrap: wrap; }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0.2rem 0.4rem;
            border-radius: var(--radius-full);
            font-size: 0.6rem;
            font-weight: 500;
            border: 1px solid var(--border);
        }

        .chip.task { border-color: var(--success); background: var(--success-bg); }
        .chip.reminder { border-color: var(--info); background: var(--info-bg); }
        .chip.promise { border-color: var(--warning); background: var(--warning-bg); }

        /* Reminders */
        .reminder-card { border-left: 4px solid; }
        .reminder-card.task { border-left-color: var(--success); }
        .reminder-card.reminder { border-left-color: var(--info); }
        .reminder-card.promise { border-left-color: var(--warning); }
        .reminder-card.payment { border-left-color: var(--danger); }

        .reminder-header { display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem; flex-wrap: wrap; }

        .reminder-type {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 0.15rem 0.375rem;
            border-radius: var(--radius-sm);
        }

        .reminder-card.task .reminder-type { background: var(--success-bg); color: var(--success); }
        .reminder-card.reminder .reminder-type { background: var(--info-bg); color: var(--info); }
        .reminder-card.promise .reminder-type { background: var(--warning-bg); color: #b45309; }
        .reminder-card.payment .reminder-type { background: var(--danger-bg); color: var(--danger); }

        .reminder-priority {
            font-size: 0.55rem;
            padding: 0.1rem 0.25rem;
            border-radius: var(--radius-sm);
            background: var(--danger-bg);
            color: var(--danger);
        }

        .reminder-content { font-size: 0.85rem; color: var(--text-primary); margin-bottom: 0.25rem; }
        .reminder-meta { font-size: 0.7rem; color: var(--text-secondary); }
        .reminder-actions { display: flex; gap: 0.25rem; margin-top: 0.375rem; }

        .r-action-btn {
            flex: 1;
            padding: 0.4rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            background: white;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.2rem;
        }

        .r-action-btn:hover { background: var(--bg-secondary); }
        .r-action-btn.done { border-color: var(--success); color: var(--success); }
        .r-action-btn.done:hover { background: var(--success-bg); }
        .r-action-btn.snooze { border-color: var(--warning); color: #b45309; }
        .r-action-btn.snooze:hover { background: var(--warning-bg); }

        /* Empty State */
        .empty { text-align: center; padding: 2rem 1rem; }
        .empty-icon { font-size: 2.5rem; margin-bottom: 0.375rem; }
        .empty-title { font-size: 0.95rem; font-weight: 600; color: var(--text-primary); }
        .empty-desc { font-size: 0.8rem; color: var(--text-secondary); }

        /* Settings */
        .settings { display: none; }
        .settings.active { display: block; }

        .settings-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }

        .settings-title { font-size: 0.85rem; font-weight: 700; margin-bottom: 0.625rem; }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child { border-bottom: none; }
        .setting-label { font-size: 0.8rem; font-weight: 500; }
        .setting-desc { font-size: 0.65rem; color: var(--text-secondary); }

        .setting-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-family: monospace;
            margin-top: 0.375rem;
        }

        .setting-input:focus { outline: none; border-color: var(--primary); }

        .toggle {
            width: 40px;
            height: 22px;
            background: var(--border);
            border-radius: 11px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle.active { background: var(--success); }

        .toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .toggle.active::after { left: 20px; }

        .btn {
            padding: 0.5rem 0.875rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-danger { background: var(--danger-bg); color: var(--danger); }
        .btn-sm { padding: 0.35rem 0.625rem; font-size: 0.7rem; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0; right: 0;
            background: white;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem;
            padding-bottom: calc(0.5rem + var(--safe-bottom));
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.375rem 1rem;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 0.6rem;
            font-weight: 500;
            border-radius: var(--radius-lg);
            position: relative;
        }

        .nav-item:hover { background: var(--bg-secondary); }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.25rem; margin-bottom: 0.125rem; }

        .nav-badge {
            position: absolute;
            top: 0;
            right: 0.5rem;
            background: var(--danger);
            color: white;
            font-size: 0.5rem;
            padding: 0.1rem 0.25rem;
            border-radius: var(--radius-full);
            font-weight: 700;
        }

        /* Toast */
        .toast-box { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 9999; }

        .toast {
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 0.625rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            box-shadow: var(--shadow-xl);
            animation: toastIn 0.3s ease;
            white-space: nowrap;
        }

        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.warning { background: var(--warning); color: #1f2937; }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 380px) {
            .header-title { font-size: 2rem; }
            .mic-btn { width: 100px; height: 100px; font-size: 2.25rem; }
            .recording-card { padding: 1.25rem 1rem; }
        }

        .hidden { display: none !important; }
    </style>
</head>

<body>
    <!-- iOS Install Banner (Bottom Sheet Style) -->
    <div class="ios-install-banner" id="iosInstallBanner">
        <div class="ios-install-header">
            <div class="ios-install-title">
                üì≤ Install VoxValt
            </div>
            <button class="ios-install-close" id="iosInstallClose">‚úï</button>
        </div>
        <div class="ios-install-steps">
            <div class="ios-step">
                <div class="ios-step-number">1</div>
                <div class="ios-step-content">
                    <div class="ios-step-text">Tap the Share button</div>
                    <div class="ios-step-hint">At the bottom of Safari</div>
                </div>
                <div class="share-icon-box">
                    <svg viewBox="0 0 24 24"><path d="M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"/></svg>
                </div>
            </div>
            <div class="ios-step">
                <div class="ios-step-number">2</div>
                <div class="ios-step-content">
                    <div class="ios-step-text">Scroll & tap "Add to Home Screen"</div>
                    <div class="ios-step-hint">Look for the ‚ûï icon</div>
                </div>
                <div class="ios-step-icon">‚ûï</div>
            </div>
            <div class="ios-step">
                <div class="ios-step-number">3</div>
                <div class="ios-step-content">
                    <div class="ios-step-text">Tap "Add" to install</div>
                    <div class="ios-step-hint">VoxValt will appear on your home screen</div>
                </div>
                <div class="ios-step-icon">‚úì</div>
            </div>
        </div>
    </div>

    <!-- Android Install Banner (Top) -->
    <div class="android-install-banner" id="androidInstallBanner">
        <div class="android-install-info">
            <span class="android-install-icon">üì≤</span>
            <div class="android-install-text">
                <strong>Install VoxValt</strong>
                Quick access & offline mode
            </div>
        </div>
        <div class="android-install-actions">
            <button class="android-btn android-btn-primary" id="androidInstallBtn">Install</button>
            <button class="android-btn android-btn-secondary" id="androidDismissBtn">Later</button>
        </div>
    </div>

    <div class="container">
        <!-- Standalone Mode Badge -->
        <div class="standalone-badge" id="standaloneBadge">
            ‚úÖ App Installed Successfully!
        </div>

        <!-- Notification Banner -->
        <div class="notif-banner" id="notifBanner">
            <div class="notif-content">
                <span class="notif-icon">üîî</span>
                <div class="notif-body">
                    <div class="notif-title">Enable Notifications</div>
                    <div class="notif-desc">Get reminded about your tasks</div>
                    <div class="notif-actions">
                        <button class="notif-btn notif-btn-primary" id="enableNotif">Enable</button>
                        <button class="notif-btn notif-btn-secondary" id="dismissNotif">Later</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Panel -->
        <div id="mainPanel">
            <header class="header">
                <div class="header-icon">üéôÔ∏è</div>
                <h1 class="header-title">VoxValt</h1>
                <p class="header-subtitle">Voice memory assistant</p>
                <div class="header-badges">
                    <span class="badge badge-pwa">üì± PWA</span>
                    <span class="badge badge-free">üí∞ Free</span>
                    <span class="badge badge-status" id="statusBadge">üåê Online</span>
                </div>
            </header>

            <div class="recording-card">
                <div class="processing" id="processing">
                    <div class="processing-content">
                        <div class="spinner"></div>
                        <p class="processing-text" id="processingText">Processing...</p>
                        <p class="processing-sub" id="processingSub">Please wait</p>
                    </div>
                </div>

                <div class="recording-content">
                    <div class="mic-wrapper" id="micWrapper">
                        <div class="pulse-ring"></div>
                        <div class="pulse-ring"></div>
                        <div class="pulse-ring"></div>
                        <button class="mic-btn" id="micBtn">üé§</button>
                    </div>

                    <p class="btn-label" id="btnLabel">Tap to record</p>
                    <p class="btn-hint" id="btnHint">Voice ‚Üí Text ‚Üí Smart Reminders</p>

                    <div class="duration" id="duration">00:00</div>
                    <div class="visualizer" id="visualizer"></div>

                    <div class="live-transcript" id="liveTranscript">
                        <div class="transcript-label">üé§ Live Transcription</div>
                        <div class="transcript-text" id="transcriptText">Listening...</div>
                    </div>

                    <div class="status-bar">
                        <div class="status-dot" id="statusDot"></div>
                        <span class="status-text" id="statusText">Ready</span>
                    </div>
                </div>
            </div>

            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="memos">üé§ Memos <span class="tab-count" id="memosCount">0</span></button>
                    <button class="tab-btn" data-tab="reminders">‚è∞ Reminders <span class="tab-count" id="remindersCount">0</span></button>
                </div>
                <div class="tab-content active" id="memosTab">
                    <div id="memosContainer">
                        <div class="empty">
                            <div class="empty-icon">üéôÔ∏è</div>
                            <p class="empty-title">No memos yet</p>
                            <p class="empty-desc">Tap the mic to start</p>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="remindersTab">
                    <div id="remindersContainer">
                        <div class="empty">
                            <div class="empty-icon">‚è∞</div>
                            <p class="empty-title">No reminders</p>
                            <p class="empty-desc">Record a memo with tasks</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings" id="settingsPanel">
            <header class="header">
                <div class="header-icon">‚öôÔ∏è</div>
                <h1 class="header-title">Settings</h1>
            </header>

            <div class="settings-section">
                <div class="settings-title">üß† AI Provider (FREE)</div>
                <div class="setting-item" style="flex-direction: column; align-items: stretch;">
                    <div class="setting-label">Groq API Key</div>
                    <div class="setting-desc">Free Llama 3.1 ‚Ä¢ console.groq.com</div>
                    <input type="password" class="setting-input" id="groqInput" placeholder="gsk_xxxxxxxxxx">
                </div>
                <div style="display: flex; gap: 0.375rem; margin-top: 0.375rem;">
                    <button class="btn btn-primary btn-sm" id="saveGroq">üíæ Save</button>
                    <button class="btn btn-danger btn-sm hidden" id="clearGroq">üóëÔ∏è Clear</button>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">üîî Notifications</div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Push Notifications</div>
                        <div class="setting-desc" id="notifStatus">Click to enable</div>
                    </div>
                    <div class="toggle" id="notifToggle"></div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">üì± App Install</div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label" id="installStatusLabel">Not Installed</div>
                        <div class="setting-desc" id="installStatusDesc">Use Share ‚Üí Add to Home Screen</div>
                    </div>
                    <button class="btn btn-primary btn-sm" id="showInstallGuide">How to Install</button>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">üíæ Data</div>
                <div class="setting-item">
                    <div class="setting-label">Storage</div>
                    <div class="setting-desc" id="storageUsed">--</div>
                </div>
                <div style="display: flex; gap: 0.375rem; margin-top: 0.375rem;">
                    <button class="btn btn-secondary btn-sm" id="exportBtn">üì§ Export</button>
                    <button class="btn btn-danger btn-sm" id="clearBtn">üóëÔ∏è Clear</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" data-panel="main">
            <span class="nav-icon">üé§</span>
            <span>Record</span>
        </button>
        <button class="nav-item" data-panel="reminders" style="position: relative;">
            <span class="nav-icon">‚è∞</span>
            <span>Reminders</span>
            <span class="nav-badge hidden" id="reminderBadge">0</span>
        </button>
        <button class="nav-item" data-panel="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </nav>

    <div class="toast-box" id="toastBox"></div>

    <script>
        // ============================================
        // PLATFORM DETECTION
        // ============================================
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                            window.navigator.standalone === true;

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
                self.addEventListener('install', e => self.skipWaiting());
                self.addEventListener('activate', e => e.waitUntil(clients.claim()));
                self.addEventListener('push', e => {
                    const d = e.data ? e.data.json() : {};
                    self.registration.showNotification(d.title || 'VoxValt', {
                        body: d.body || 'Reminder!',
                        icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Crect width="100" height="100" rx="20" fill="%23667eea"/%3E%3Ctext x="50" y="68" font-size="55" text-anchor="middle"%3Eüéô%3C/text%3E%3C/svg%3E',
                        requireInteraction: true
                    });
                });
            `], { type: 'application/javascript' })));
        }

        class VoxValt {
            constructor() {
                this.recording = false;
                this.mediaRecorder = null;
                this.chunks = [];
                this.audioCtx = null;
                this.analyser = null;
                this.stream = null;
                this.startTime = null;
                this.timer = null;
                this.animFrame = null;
                this.recognition = null;
                this.transcript = '';
                this.memos = [];
                this.reminders = [];
                this.playing = null;
                this.groqKey = null;
                this.deferredPrompt = null;
                this.nlp = new OfflineNLP();
                this.init();
            }

            init() {
                this.initEls();
                this.initViz();
                this.loadData();
                this.bindEvents();
                this.checkInstallStatus();
                this.checkNotif();
                this.updateOnline();
            }

            initEls() {
                // iOS Install
                this.iosInstallBanner = document.getElementById('iosInstallBanner');
                this.iosInstallClose = document.getElementById('iosInstallClose');

                // Android Install
                this.androidInstallBanner = document.getElementById('androidInstallBanner');
                this.androidInstallBtn = document.getElementById('androidInstallBtn');
                this.androidDismissBtn = document.getElementById('androidDismissBtn');

                // Standalone Badge
                this.standaloneBadge = document.getElementById('standaloneBadge');

                // Install Guide Button
                this.showInstallGuide = document.getElementById('showInstallGuide');
                this.installStatusLabel = document.getElementById('installStatusLabel');
                this.installStatusDesc = document.getElementById('installStatusDesc');

                // Notifications
                this.notifBanner = document.getElementById('notifBanner');
                this.enableNotif = document.getElementById('enableNotif');
                this.dismissNotif = document.getElementById('dismissNotif');
                this.notifToggle = document.getElementById('notifToggle');
                this.notifStatus = document.getElementById('notifStatus');

                // Recording
                this.micBtn = document.getElementById('micBtn');
                this.micWrapper = document.getElementById('micWrapper');
                this.btnLabel = document.getElementById('btnLabel');
                this.btnHint = document.getElementById('btnHint');
                this.durationEl = document.getElementById('duration');
                this.visualizer = document.getElementById('visualizer');
                this.liveTranscript = document.getElementById('liveTranscript');
                this.transcriptText = document.getElementById('transcriptText');
                this.statusDot = document.getElementById('statusDot');
                this.statusText = document.getElementById('statusText');
                this.statusBadge = document.getElementById('statusBadge');
                this.processing = document.getElementById('processing');
                this.processingText = document.getElementById('processingText');
                this.processingSub = document.getElementById('processingSub');

                // Content
                this.memosContainer = document.getElementById('memosContainer');
                this.memosCount = document.getElementById('memosCount');
                this.remindersContainer = document.getElementById('remindersContainer');
                this.remindersCount = document.getElementById('remindersCount');
                this.reminderBadge = document.getElementById('reminderBadge');
                this.toastBox = document.getElementById('toastBox');

                // Panels
                this.mainPanel = document.getElementById('mainPanel');
                this.settingsPanel = document.getElementById('settingsPanel');

                // Settings
                this.groqInput = document.getElementById('groqInput');
                this.saveGroq = document.getElementById('saveGroq');
                this.clearGroq = document.getElementById('clearGroq');
                this.storageUsed = document.getElementById('storageUsed');
                this.exportBtn = document.getElementById('exportBtn');
                this.clearBtn = document.getElementById('clearBtn');
            }

            initViz() {
                this.visualizer.innerHTML = '';
                for (let i = 0; i < 24; i++) {
                    const b = document.createElement('div');
                    b.className = 'audio-bar';
                    this.visualizer.appendChild(b);
                }
                this.bars = this.visualizer.querySelectorAll('.audio-bar');
            }

            bindEvents() {
                // iOS Install
                this.iosInstallClose.onclick = () => {
                    this.iosInstallBanner.classList.remove('show');
                    localStorage.setItem('vv_ios_dismissed', Date.now());
                };

                // Android Install
                this.androidInstallBtn.onclick = () => this.installPWA();
                this.androidDismissBtn.onclick = () => {
                    this.androidInstallBanner.classList.remove('show');
                    localStorage.setItem('vv_android_dismissed', Date.now());
                };

                // Show Install Guide
                this.showInstallGuide.onclick = () => {
                    if (isIOS) {
                        this.iosInstallBanner.classList.add('show');
                    } else {
                        this.toast('Use browser menu ‚Üí Install App', 'info');
                    }
                };

                // Notifications
                this.enableNotif.onclick = () => this.requestNotif();
                this.dismissNotif.onclick = () => this.notifBanner.classList.remove('show');
                this.notifToggle.onclick = () => this.toggleNotif();

                // Recording
                this.micBtn.onclick = () => this.toggleRec();

                // Tabs
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.onclick = () => {
                        document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
                        b.classList.add('active');
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        document.getElementById(b.dataset.tab + 'Tab').classList.add('active');
                    };
                });

                // Nav
                document.querySelectorAll('.nav-item').forEach(n => {
                    n.onclick = () => {
                        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
                        n.classList.add('active');
                        const p = n.dataset.panel;
                        this.mainPanel.classList.toggle('hidden', p === 'settings');
                        this.settingsPanel.classList.toggle('active', p === 'settings');
                        if (p === 'reminders') document.querySelector('[data-tab="reminders"]').click();
                    };
                });

                // Settings
                this.saveGroq.onclick = () => this.saveGroqKey();
                this.clearGroq.onclick = () => this.clearGroqKey();
                this.exportBtn.onclick = () => this.exportData();
                this.clearBtn.onclick = () => this.clearAllData();

                // Online status
                window.addEventListener('online', () => this.updateOnline());
                window.addEventListener('offline', () => this.updateOnline());

                // Android install prompt
                window.addEventListener('beforeinstallprompt', e => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    const dismissed = localStorage.getItem('vv_android_dismissed');
                    if (!dismissed || Date.now() - parseInt(dismissed) > 7 * 24 * 60 * 60 * 1000) {
                        this.androidInstallBanner.classList.add('show');
                    }
                });
            }

            checkInstallStatus() {
                if (isStandalone) {
                    // Already installed
                    this.standaloneBadge.classList.add('show');
                    this.installStatusLabel.textContent = '‚úÖ Installed';
                    this.installStatusDesc.textContent = 'Running as standalone app';
                    this.showInstallGuide.textContent = 'Installed ‚úì';
                    this.showInstallGuide.disabled = true;
                    setTimeout(() => this.standaloneBadge.classList.remove('show'), 3000);
                } else if (isIOS && isSafari) {
                    // iOS Safari - show install guide after delay
                    this.installStatusLabel.textContent = 'Not Installed';
                    this.installStatusDesc.textContent = 'Tap to see how to install';
                    const dismissed = localStorage.getItem('vv_ios_dismissed');
                    if (!dismissed || Date.now() - parseInt(dismissed) > 24 * 60 * 60 * 1000) {
                        setTimeout(() => {
                            this.iosInstallBanner.classList.add('show');
                        }, 2000);
                    }
                } else if (isIOS && !isSafari) {
                    // iOS but not Safari
                    this.installStatusLabel.textContent = 'Open in Safari';
                    this.installStatusDesc.textContent = 'PWA install only works in Safari';
                    this.showInstallGuide.textContent = 'Open Safari';
                }
            }

            async installPWA() {
                if (this.deferredPrompt) {
                    this.deferredPrompt.prompt();
                    const result = await this.deferredPrompt.userChoice;
                    if (result.outcome === 'accepted') {
                        this.toast('App installed! üéâ', 'success');
                    }
                    this.deferredPrompt = null;
                    this.androidInstallBanner.classList.remove('show');
                }
            }

            checkNotif() {
                if (!('Notification' in window)) return;
                if (Notification.permission === 'granted') {
                    this.notifToggle.classList.add('active');
                    this.notifStatus.textContent = 'Enabled';
                } else if (Notification.permission === 'default') {
                    setTimeout(() => this.notifBanner.classList.add('show'), 3000);
                }
            }

            async requestNotif() {
                if (!('Notification' in window)) return this.toast('Not supported', 'error');
                const p = await Notification.requestPermission();
                if (p === 'granted') {
                    this.notifToggle.classList.add('active');
                    this.notifStatus.textContent = 'Enabled';
                    this.notifBanner.classList.remove('show');
                    this.toast('Notifications enabled!', 'success');
                    new Notification('VoxValt Ready!', { body: 'You\'ll get reminders now' });
                } else {
                    this.notifStatus.textContent = 'Denied';
                    this.toast('Permission denied', 'error');
                }
            }

            toggleNotif() {
                if (Notification.permission !== 'granted') this.requestNotif();
                else this.toast('Already enabled', 'success');
            }

            updateOnline() {
                const o = navigator.onLine;
                this.statusBadge.textContent = o ? 'üåê Online' : 'üì¥ Offline';
                this.statusBadge.style.background = o ? 'var(--success)' : 'var(--warning)';
            }

            async toggleRec() {
                if (this.recording) await this.stopRec();
                else await this.startRec();
            }

            async startRec() {
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioCtx.createAnalyser();
                    this.analyser.fftSize = 64;
                    const s = this.audioCtx.createMediaStreamSource(this.stream);
                    s.connect(this.analyser);
                    const mt = MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/mp4';
                    this.mediaRecorder = new MediaRecorder(this.stream, { mimeType: mt });
                    this.chunks = [];
                    this.mediaRecorder.ondataavailable = e => { if (e.data.size > 0) this.chunks.push(e.data); };
                    this.mediaRecorder.start(100);
                    this.startSpeech();
                    this.recording = true;
                    this.startTime = Date.now();
                    this.transcript = '';
                    this.micBtn.classList.add('recording');
                    this.micWrapper.classList.add('recording');
                    this.micBtn.textContent = '‚èπÔ∏è';
                    this.btnLabel.textContent = 'Recording...';
                    this.btnHint.textContent = 'Tap to stop';
                    this.durationEl.classList.add('active');
                    this.visualizer.classList.add('active');
                    this.liveTranscript.classList.add('active');
                    this.statusDot.classList.add('recording');
                    this.statusText.textContent = 'Recording';
                    this.timer = setInterval(() => this.updateTimer(), 100);
                    this.visualize();
                } catch (e) {
                    this.toast('Microphone denied', 'error');
                }
            }

            startSpeech() {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SR) return;
                this.recognition = new SR();
                this.recognition.lang = 'en-US';
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                let final = '';
                this.recognition.onresult = e => {
                    let interim = '';
                    for (let i = e.resultIndex; i < e.results.length; i++) {
                        const t = e.results[i][0].transcript;
                        if (e.results[i].isFinal) final += t + ' ';
                        else interim += t;
                    }
                    this.transcript = final;
                    this.transcriptText.textContent = (final + interim) || 'Listening...';
                };
                this.recognition.onend = () => {
                    if (this.recording) try { this.recognition.start(); } catch (e) { }
                };
                try { this.recognition.start(); } catch (e) { }
            }

            async stopRec() {
                if (!this.recording) return;
                this.recording = false;
                clearInterval(this.timer);
                cancelAnimationFrame(this.animFrame);
                if (this.recognition) try { this.recognition.stop(); } catch (e) { }
                if (this.mediaRecorder?.state !== 'inactive') this.mediaRecorder.stop();
                this.stream?.getTracks().forEach(t => t.stop());
                this.audioCtx?.close();
                this.micBtn.classList.remove('recording');
                this.micWrapper.classList.remove('recording');
                this.micBtn.textContent = 'üé§';
                this.btnLabel.textContent = 'Tap to record';
                this.btnHint.textContent = 'Voice ‚Üí Text ‚Üí Smart Reminders';
                this.durationEl.classList.remove('active');
                this.visualizer.classList.remove('active');
                this.liveTranscript.classList.remove('active');
                this.statusDot.classList.remove('recording');
                this.statusText.textContent = 'Ready';
                this.bars.forEach(b => { b.style.height = '4px'; b.classList.remove('active'); });
                await new Promise(r => setTimeout(r, 200));
                await this.processMemo();
            }

            updateTimer() {
                const e = Date.now() - this.startTime;
                const s = Math.floor(e / 1000);
                this.durationEl.textContent = `${Math.floor(s / 60).toString().padStart(2, '0')}:${(s % 60).toString().padStart(2, '0')}`;
            }

            visualize() {
                if (!this.recording || !this.analyser) return;
                const d = new Uint8Array(this.analyser.frequencyBinCount);
                this.analyser.getByteFrequencyData(d);
                const step = Math.floor(d.length / this.bars.length);
                this.bars.forEach((b, i) => {
                    const v = d[i * step] || 0;
                    b.style.height = `${Math.max(4, (v / 255) * 45)}px`;
                    b.classList.toggle('active', v > 25);
                });
                this.animFrame = requestAnimationFrame(() => this.visualize());
            }

            async processMemo() {
                if (this.chunks.length === 0) return;
                const blob = new Blob(this.chunks, { type: 'audio/webm' });
                const dur = Date.now() - this.startTime;
                const memo = {
                    id: Date.now(),
                    audioUrl: URL.createObjectURL(blob),
                    timestamp: new Date().toISOString(),
                    duration: dur,
                    transcription: this.transcript.trim(),
                    extractions: []
                };
                if (memo.transcription) {
                    this.showProcessing('Extracting tasks...', 'AI analyzing');
                    try {
                        let ex;
                        if (this.groqKey) ex = await this.extractGroq(memo.transcription);
                        else ex = this.nlp.extract(memo.transcription);
                        memo.extractions = ex;
                        ex.forEach(e => this.reminders.push({
                            id: Date.now() + Math.random(),
                            memoId: memo.id,
                            type: e.type,
                            content: e.content,
                            datetime: e.datetime,
                            person: e.person,
                            priority: e.priority,
                            completed: false,
                            createdAt: new Date().toISOString()
                        }));
                        this.hideProcessing();
                        this.toast(`‚ú® Created ${ex.length} reminders!`, 'success');
                    } catch (err) {
                        this.hideProcessing();
                        const ex = this.nlp.extract(memo.transcription);
                        memo.extractions = ex;
                        this.toast('Extracted offline', 'warning');
                    }
                }
                this.memos.unshift(memo);
                this.saveData();
                this.renderMemos();
                this.renderReminders();
                this.durationEl.textContent = '00:00';
            }

            showProcessing(t, s) {
                this.processingText.textContent = t;
                this.processingSub.textContent = s;
                this.processing.classList.add('active');
            }

            hideProcessing() {
                this.processing.classList.remove('active');
            }

            async extractGroq(text) {
                const prompt = `Extract actionable items from this voice memo. Return JSON only.\nTypes: task, promise, reminder, payment\nFormat: {"extractions": [{"type": "task", "content": "...", "datetime": "...", "person": "...", "priority": "high/normal"}]}\nText: "${text}"`;
                const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${this.groqKey}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: 'llama-3.1-70b-versatile', messages: [{ role: 'user', content: prompt }], temperature: 0.3, max_tokens: 1024 })
                });
                if (!res.ok) throw new Error('API error');
                const data = await res.json();
                const content = data.choices[0].message.content;
                const m = content.match(/\{[\s\S]*\}/);
                if (m) {
                    const p = JSON.parse(m[0]);
                    return (p.extractions || []).map(e => ({ ...e, id: Date.now() + Math.random(), source: 'groq' }));
                }
                return [];
            }

            saveData() {
                const md = this.memos.map(m => ({ id: m.id, timestamp: m.timestamp, duration: m.duration, transcription: m.transcription, extractions: m.extractions }));
                localStorage.setItem('vv_memos', JSON.stringify(md));
                localStorage.setItem('vv_reminders', JSON.stringify(this.reminders));
            }

            loadData() {
                this.groqKey = localStorage.getItem('vv_groq');
                if (this.groqKey) {
                    this.groqInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    this.clearGroq.classList.remove('hidden');
                }
                const m = localStorage.getItem('vv_memos');
                if (m) this.memos = JSON.parse(m).map(x => ({ ...x, audioUrl: null }));
                const r = localStorage.getItem('vv_reminders');
                if (r) this.reminders = JSON.parse(r);
                this.renderMemos();
                this.renderReminders();
                this.updateStorage();
            }

            saveGroqKey() {
                const k = this.groqInput.value.trim();
                if (!k || k.includes('‚Ä¢')) return;
                if (!k.startsWith('gsk_')) return this.toast('Invalid key', 'error');
                this.groqKey = k;
                localStorage.setItem('vv_groq', k);
                this.groqInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                this.clearGroq.classList.remove('hidden');
                this.toast('Key saved!', 'success');
            }

            clearGroqKey() {
                this.groqKey = null;
                localStorage.removeItem('vv_groq');
                this.groqInput.value = '';
                this.clearGroq.classList.add('hidden');
                this.toast('Key cleared', 'warning');
            }

            updateStorage() {
                const d = JSON.stringify(localStorage);
                const kb = (new Blob([d]).size / 1024).toFixed(1);
                this.storageUsed.textContent = `${kb} KB`;
            }

            exportData() {
                const d = { memos: this.memos, reminders: this.reminders, exportedAt: new Date().toISOString() };
                const b = new Blob([JSON.stringify(d, null, 2)], { type: 'application/json' });
                const u = URL.createObjectURL(b);
                const a = document.createElement('a');
                a.href = u;
                a.download = `voxvalt-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(u);
                this.toast('Exported!', 'success');
            }

            clearAllData() {
                if (confirm('Delete all data?')) {
                    this.memos = [];
                    this.reminders = [];
                    localStorage.removeItem('vv_memos');
                    localStorage.removeItem('vv_reminders');
                    this.renderMemos();
                    this.renderReminders();
                    this.toast('Cleared', 'warning');
                }
            }

            formatDur(ms) {
                const s = Math.floor(ms / 1000);
                return `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;
            }

            formatTime(iso) {
                const d = new Date(iso);
                const now = new Date();
                const time = d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                if (d.toDateString() === now.toDateString()) return `Today ${time}`;
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ` ${time}`;
            }

            getIcon(t) { return { task: '‚úÖ', promise: 'ü§ù', reminder: '‚è∞', payment: 'üí∞' }[t] || 'üìå'; }

            renderMemos() {
                this.memosCount.textContent = this.memos.length;
                if (this.memos.length === 0) {
                    this.memosContainer.innerHTML = `<div class="empty"><div class="empty-icon">üéôÔ∏è</div><p class="empty-title">No memos yet</p><p class="empty-desc">Tap the mic to start</p></div>`;
                    return;
                }
                this.memosContainer.innerHTML = this.memos.map(m => `
                    <div class="memo-card" data-id="${m.id}">
                        <div class="memo-header">
                            <div class="memo-icon">üé§</div>
                            <div class="memo-info"><div class="memo-time">${this.formatTime(m.timestamp)}</div><div class="memo-dur">${this.formatDur(m.duration)}</div></div>
                            <div class="memo-actions"><button class="action-btn delete" data-id="${m.id}">üóëÔ∏è</button></div>
                        </div>
                        ${m.audioUrl ? `<div class="memo-audio"><button class="play-btn" data-id="${m.id}">‚ñ∂Ô∏è</button><div class="progress-wrap"><div class="progress-bar" data-id="${m.id}"><div class="progress-fill" id="prog-${m.id}"></div></div><div class="audio-time"><span id="cur-${m.id}">0:00</span><span>${this.formatDur(m.duration)}</span></div></div></div>` : ''}
                        ${m.transcription ? `<div class="memo-text">${m.transcription}</div>` : ''}
                        ${m.extractions?.length > 0 ? `<div class="memo-chips">${m.extractions.map(e => `<span class="chip ${e.type}">${this.getIcon(e.type)} ${e.content.slice(0, 25)}${e.content.length > 25 ? '...' : ''}</span>`).join('')}</div>` : ''}
                    </div>
                `).join('');
                this.bindMemoEvents();
            }

            bindMemoEvents() {
                document.querySelectorAll('.play-btn').forEach(b => b.onclick = () => this.togglePlay(parseInt(b.dataset.id), b));
                document.querySelectorAll('.action-btn.delete').forEach(b => b.onclick = () => this.deleteMemo(parseInt(b.dataset.id)));
            }

            togglePlay(id, btn) {
                const m = this.memos.find(x => x.id === id);
                if (!m?.audioUrl) return;
                if (this.playing?.id !== id) {
                    this.playing?.audio.pause();
                    document.querySelectorAll('.play-btn').forEach(b => b.textContent = '‚ñ∂Ô∏è');
                }
                if (this.playing?.id === id) {
                    if (this.playing.audio.paused) { this.playing.audio.play(); btn.textContent = '‚è∏Ô∏è'; }
                    else { this.playing.audio.pause(); btn.textContent = '‚ñ∂Ô∏è'; }
                    return;
                }
                const audio = new Audio(m.audioUrl);
                this.playing = { id, audio };
                const fill = document.getElementById(`prog-${id}`);
                const cur = document.getElementById(`cur-${id}`);
                audio.ontimeupdate = () => {
                    if (fill) fill.style.width = `${(audio.currentTime / audio.duration) * 100}%`;
                    if (cur) cur.textContent = this.formatDur(audio.currentTime * 1000);
                };
                audio.onended = () => { btn.textContent = '‚ñ∂Ô∏è'; if (fill) fill.style.width = '0%'; this.playing = null; };
                audio.play();
                btn.textContent = '‚è∏Ô∏è';
            }

            deleteMemo(id) {
                this.memos = this.memos.filter(m => m.id !== id);
                this.reminders = this.reminders.filter(r => r.memoId !== id);
                this.saveData();
                this.renderMemos();
                this.renderReminders();
                this.toast('Deleted', 'warning');
            }

            renderReminders() {
                const active = this.reminders.filter(r => !r.completed);
                this.remindersCount.textContent = active.length;
                if (active.length > 0) {
                    this.reminderBadge.textContent = active.length;
                    this.reminderBadge.classList.remove('hidden');
                } else {
                    this.reminderBadge.classList.add('hidden');
                }
                if (this.reminders.length === 0) {
                    this.remindersContainer.innerHTML = `<div class="empty"><div class="empty-icon">‚è∞</div><p class="empty-title">No reminders</p><p class="empty-desc">Record a memo with tasks</p></div>`;
                    return;
                }
                this.remindersContainer.innerHTML = this.reminders.map(r => `
                    <div class="reminder-card ${r.type}" style="opacity:${r.completed ? '0.5' : '1'}">
                        <div class="reminder-header">
                            <span class="reminder-type">${this.getIcon(r.type)} ${r.type}</span>
                            ${r.priority === 'high' ? '<span class="reminder-priority">üî• High</span>' : ''}
                        </div>
                        <div class="reminder-content" style="${r.completed ? 'text-decoration:line-through' : ''}">${r.content}</div>
                        <div class="reminder-meta">${r.datetime ? `üìÖ ${r.datetime}` : ''}${r.person ? ` üë§ ${r.person}` : ''}</div>
                        ${!r.completed ? `<div class="reminder-actions"><button class="r-action-btn done" data-id="${r.id}">‚úì Done</button><button class="r-action-btn snooze" data-id="${r.id}">‚è∞ Snooze</button></div>` : ''}
                    </div>
                `).join('');
                document.querySelectorAll('.r-action-btn.done').forEach(b => b.onclick = () => this.completeReminder(parseFloat(b.dataset.id)));
                document.querySelectorAll('.r-action-btn.snooze').forEach(b => b.onclick = () => this.snoozeReminder(parseFloat(b.dataset.id)));
            }

            completeReminder(id) {
                const r = this.reminders.find(x => x.id === id);
                if (r) { r.completed = true; this.saveData(); this.renderReminders(); this.toast('Done! ‚úì', 'success'); }
            }

            snoozeReminder(id) { this.toast('Snoozed 30 min', 'success'); }

            toast(msg, type = 'info') {
                const t = document.createElement('div');
                t.className = `toast ${type}`;
                t.textContent = msg;
                this.toastBox.appendChild(t);
                setTimeout(() => t.remove(), 3000);
            }
        }

        class OfflineNLP {
            extract(text) {
                const results = [];
                const patterns = {
                    task: [/(?:need to|have to|must|should)\s+(.+?)(?:\.|,|$)/gi],
                    reminder: [/(?:remind(?:er)?(?:\s+me)?(?:\s+to)?)\s+(.+?)(?:\.|,|$)/gi],
                    promise: [/(?:i(?:'ll| will)|promised?)\s+(.+?)(?:\.|,|$)/gi],
                    payment: [/(?:pay|bill)\s+(.+?)(?:\.|,|$)/gi]
                };
                const datePatterns = [/tomorrow/i, /today/i, /tonight/i, /next\s+\w+/i, /at\s+\d+/i];
                for (const [type, regexes] of Object.entries(patterns)) {
                    for (const regex of regexes) {
                        const matches = [...text.matchAll(regex)];
                        for (const match of matches) {
                            const content = match[1]?.trim() || match[0].trim();
                            if (content.length > 3) {
                                let datetime = null;
                                for (const dp of datePatterns) { const dm = text.match(dp); if (dm) { datetime = dm[0]; break; } }
                                results.push({ id: Date.now() + Math.random(), type, content, datetime, person: null, priority: /urgent|asap|today/i.test(text) ? 'high' : 'normal', source: 'offline' });
                            }
                        }
                    }
                }
                return results;
            }
        }

        document.addEventListener('DOMContentLoaded', () => { window.voxvalt = new VoxValt(); });
    </script>
</body>
</html>
